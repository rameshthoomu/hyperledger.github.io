<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>CA Setup - Hyperledger Fabric</title>
  

  <link rel="shortcut icon" href="../../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  <link href="../../css/second_extra.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "CA Setup";
    var mkdocs_page_input_path = "Setup\ca-setup.md";
    var mkdocs_page_url = "/Setup/ca-setup/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 
  <script src="../../API/Samples/Sample_1.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Hyperledger Fabric</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../glossary/">Glossary</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../protocol-spec/">ProtocolSpec</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../protocol-spec_zh/">Protocol Spec zh</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../biz/usecases/">Usecases</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Dev-Setup</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../dev-setup/devenv/">Fabric Developer Setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../dev-setup/build/">BuildingFabric</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../dev-setup/devenv/">FabricDeveloperSetup</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Setup</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Chaincode-setup/">Chaincode or Application Developer Setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Network-setup/">Fabric Network Setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../NodeSDK-setup/">NodeSDK Setup</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">CA Setup</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#certificate-authority-ca-setup">Certificate Authority (CA) Setup</a></li>
                
                    <li><a class="toctree-l4" href="#enrollment-certificate-authority">Enrollment Certificate Authority</a></li>
                
                    <li><a class="toctree-l4" href="#transaction-certificate-authority">Transaction Certificate Authority</a></li>
                
                    <li><a class="toctree-l4" href="#tls-certificate-authority">TLS Certificate Authority</a></li>
                
            
                <li class="toctree-l3"><a href="#configuration">Configuration</a></li>
                
            
                <li class="toctree-l3"><a href="#operating-the-ca">Operating the CA</a></li>
                
                    <li><a class="toctree-l4" href="#docker-compose">Docker Compose</a></li>
                
                    <li><a class="toctree-l4" href="#build-and-run">Build and Run</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../logging-control/">Logging</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Gerrit</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Gerrit/gerrit/">Gerrit Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Gerrit/lf-account/">LF Account</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Gerrit/best-practices/">Best Practices</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Gerrit/changes/">Changes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Gerrit/reviewing/">Gerrit Review</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>API's</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../API/ChaincodeAPI/">Chaincode APIs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../API/CoreAPI/">Core API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../API/MemberServicesAPI/">CA API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../SystemChaincodes/noop/">System Chaincode</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>FAQ</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../FAQ/chaincode_FAQ/">ChainCodeFAQ</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../FAQ/confidentiality_FAQ/">ConfidentialityFAQ</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../FAQ/consensus_FAQ/">ConsensusFAQ</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../FAQ/identity_management_FAQ/">Identity ManagementFAQ</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../FAQ/usage_FAQ/">UsageFAQ</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Tech</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tech/application-ACL/">Application ACL</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tech/attributes/">Attributes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tech/best-practices/">Best Practices</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Hyperledger Fabric</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Setup &raquo;</li>
        
      
    
    <li>CA Setup</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="certificate-authority-ca-setup">Certificate Authority (CA) Setup<a class="headerlink" href="#certificate-authority-ca-setup" title="Permanent link">&para;</a></h2>
<p>The <em>Certificate Authority</em> (CA) provides a number of certificate services to users of a blockchain. More specifically, these services relate to <em>user enrollment</em>, <em>transactions</em> invoked on the blockchain, and <em>TLS</em>-secured connections between users or components of the blockchain.</p>
<p>This guide builds on either the <a href="../../dev-setup/devenv/">fabric developer&rsquo;s setup</a> or the prerequisites articulated in the <a href="../Network-setup/">fabric network setup</a> guide. If you have not already set up your environment with one of those guides, please do so before continuing.</p>
<h3 id="enrollment-certificate-authority">Enrollment Certificate Authority<a class="headerlink" href="#enrollment-certificate-authority" title="Permanent link">&para;</a></h3>
<p>The <em>enrollment certificate authority</em> (ECA) allows new users to register with the blockchain network and enables registered users to request an <em>enrollment certificate pair</em>. One certificate is for data signing, one is for data encryption. The public keys to be embedded in the certificates have to be of type ECDSA, whereby the key for data encryption is then converted by the user to be used in an <a href="https://en.wikipedia.org/wiki/Integrated_Encryption_Scheme">ECIES</a> (Elliptic Curve Integrated Encryption System) fashion.</p>
<h3 id="transaction-certificate-authority">Transaction Certificate Authority<a class="headerlink" href="#transaction-certificate-authority" title="Permanent link">&para;</a></h3>
<p>Once a user is enrolled, he or she can also request <em>transaction certificates</em> from the <em>transaction certificate authority</em> (TCA). These certificates are to be used for deploying Chaincode and for invoking Chaincode transactions on the blockchain. Although a single <em>transaction certificate</em> can be used for multiple transactions, for privacy reasons it is recommended that a new <em>transaction certificate</em> be used for each transaction.</p>
<h3 id="tls-certificate-authority">TLS Certificate Authority<a class="headerlink" href="#tls-certificate-authority" title="Permanent link">&para;</a></h3>
<p>In addition to <em>enrollment certificates</em> and <em>transaction certificates</em>, users will need <em>TLS certificates</em> to secure their communication channels. <em>TLS certificates</em> can be requested from the <em>TLS certificate authority</em> (TLSCA).</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>All CA services are provided by a single process, which can be configured by setting parameters in the CA configuration file <code>membersrvc.yaml</code>, which is located in the same directory as the CA binary. More specifically, the following parameters can be set:</p>
<ul>
<li><code>server.gomaxprocs</code>: limits the number of operating system threads used by the CA.</li>
<li><code>server.rootpath</code>: the root path of the directory where the CA stores its state.</li>
<li><code>server.cadir</code>: the name of the directory where the CA stores its state.</li>
<li><code>server.port</code>: the port at which all CA services listen (multiplexing of services over the same port is provided by <a href="http://www.grpc.io">GRPC</a>).</li>
</ul>
<p>Furthermore, logging levels can be enabled/disabled by adjusting the following settings:</p>
<ul>
<li><code>logging.trace</code> (off by default, useful for debugging the code only)</li>
<li><code>logging.info</code></li>
<li><code>logging.warning</code></li>
<li><code>logging.error</code></li>
<li><code>logging.panic</code></li>
</ul>
<p>Alternatively, these fields can be set via environment variables, which&mdash;if set&mdash;have precedence over entries in the yaml file. The corresponding environment variables are named as follows:</p>
<pre><code>    MEMBERSRVC_CA_SERVER_GOMAXPROCS
    MEMBERSRVC_CA_SERVER_ROOTPATH
    MEMBERSRVC_CA_SERVER_CADIR
    MEMBERSRVC_CA_SERVER_PORT
</code></pre>

<p>In addition, the CA may be preloaded with registered users, where each user&rsquo;s name, roles, and password are specified:</p>
<pre><code>    eca:
        users:
            alice: 2 DRJ20pEql15a
            bob: 4 7avZQLwcUe9q
</code></pre>

<p>The role value is simply a bitmask of the following:</p>
<pre><code>    CLIENT = 1;
    PEER = 2;
    VALIDATOR = 4;
    AUDITOR = 8;
</code></pre>

<p>For example, a peer that is also a validator would have a role value of 6.</p>
<p>When the CA is started for the first time, it will generate all of its required state (e.g., internal databases, CA certificates, blockchain keys, etc.) and writes this state to the directory given in its configuration. The certificates for the CA services (i.e., for the ECA, TCA, and TLSCA) are self-signed as the current default. If those certificates shall be signed by some root CA, this can be done manually by using the <code>*.priv</code> and <code>*.pub</code> private and public keys in the CA state directory, and replacing the self-signed <code>*.cert</code> certificates with root-signed ones. The next time the CA is launched, it will read and use those root-signed certificates.</p>
<h2 id="operating-the-ca">Operating the CA<a class="headerlink" href="#operating-the-ca" title="Permanent link">&para;</a></h2>
<p>You can either <a href="#build-and-run">build and run</a> the CA from source. Or, you can use Docker Compose and work with the published images on DockerHub, or some other Docker registry. Using Docker Compose is by far the simplest approach.</p>
<h3 id="docker-compose">Docker Compose<a class="headerlink" href="#docker-compose" title="Permanent link">&para;</a></h3>
<p>Here&rsquo;s a sample docker-compose.yml for the CA.</p>
<pre><code>membersrvc:
  image: hyperledger/fabric-membersrvc
  command: membersrvc
</code></pre>

<p>The corresponding docker-compose.yml for running Docker on Mac or Windows natively looks like this:</p>
<pre><code>membersrvc:
  image: hyperledger/fabric-membersrvc
  ports:
    - &quot;7054:7054&quot;
  command: membersrvc
</code></pre>

<p>If you are launching one or more <code>peer</code> nodes in the same docker-compose.yml, then you will want to add a delay to the start of the peer to allow sufficient time for the CA to start, before the peer attempts to connect to it.</p>
<pre><code>membersrvc:
  image: hyperledger/fabric-membersrvc
  command: membersrvc
vp0:
  image: hyperledger/fabric-peer
  environment:
    - CORE_PEER_ADDRESSAUTODETECT=true
    - CORE_VM_ENDPOINT=http://172.17.0.1:2375
    - CORE_LOGGING_LEVEL=DEBUG
    - CORE_PEER_ID=vp0
    - CORE_SECURITY_ENROLLID=test_vp0
    - CORE_SECURITY_ENROLLSECRET=MwYpmSRjupbT
  links:
    - membersrvc
  command: sh -c &quot;sleep 5; peer node start&quot;
</code></pre>

<p>The corresponding docker-compose.yml for running Docker on Mac or Windows natively looks like this:</p>
<pre><code>membersrvc:
  image: hyperledger/fabric-membersrvc
  ports:
    - &quot;7054:7054&quot;
  command: membersrvc
vp0:
  image: hyperledger/fabric-peer
  ports:
    - &quot;7050:7050&quot;
    - &quot;7051:7051&quot;
    - &quot;7052:7052&quot;
  environment:
    - CORE_PEER_ADDRESSAUTODETECT=true
    - CORE_VM_ENDPOINT=unix:///var/run/docker.sock
    - CORE_LOGGING_LEVEL=DEBUG
    - CORE_PEER_ID=vp0
    - CORE_SECURITY_ENROLLID=test_vp0
    - CORE_SECURITY_ENROLLSECRET=MwYpmSRjupbT
  links:
    - membersrvc
  command: sh -c &quot;sleep 5; peer node start&quot;
</code></pre>

<h3 id="build-and-run">Build and Run<a class="headerlink" href="#build-and-run" title="Permanent link">&para;</a></h3>
<p>The CA can be built with the following command executed in the <code>membersrvc</code> directory:</p>
<pre><code>cd $GOPATH/src/github.com/hyperledger/fabric
make membersrvc
</code></pre>

<p>The CA can be started with the following command:</p>
<pre><code>build/bin/membersrvc
</code></pre>

<p><strong>Note:</strong> the CA must be started before any of the fabric peer nodes, to allow the CA to have initialized before any peer nodes attempt to connect to it.</p>
<p>The CA looks for an <code>membersrvc.yaml</code> configuration file in $GOPATH/src/github.com/hyperledger/fabric/membersrvc. If the CA is started for the first time, it creates all its required state (e.g., internal databases, CA certificates, blockchain keys, etc.) and writes that state to the directory given in the CA configuration.</p>
<!-- This needs some serious attention

If starting the peer with security/privacy enabled, environment variables for security, CA address and peer's ID and password must be included. Additionally, the fabric-membersrvc container must be started before the peer(s) are launched. Hence we will need to insert a delay in launching the peer command. Here's the docker-compose.yml for a single peer with membership services running in a **Vagrant** environment:


wzxhzdk:9



wzxhzdk:10


Additionally, the validating peer `enrollID` and `enrollSecret` (`vp0` and `vp0_secret`) has to be added to [membersrvc.yaml](https://github.com/hyperledger/fabric/blob/master/membersrvc/membersrvc.yaml).
-->
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../logging-control/" class="btn btn-neutral float-right" title="Logging">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../NodeSDK-setup/" class="btn btn-neutral" title="NodeSDK Setup"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016 IBM Corp. <br></br>Contributed to the Hyperledger Project under the <a href="https://github.com/hyperledger/fabric/blob/master/LICENSE" target="_blank">Apache Software License 2.0</a></p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../NodeSDK-setup/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../logging-control/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
